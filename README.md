## Модуль интеграции с CMS Tilda
Данный модуль обеспечивает взаимодействие между интернет-магазином на базе CMS Tilda и сервисом платежей [EPOS](https://e-pos.by).
Выполнен как отдельный компонент, с которым Tilda взаимодействует через механизм [универсальной платёжной системы](https://help-ru.tilda.cc/payments/custom-payment-gateway),
и располагается на стороне разработчика сервиса E-pos

## Инструкция по настройке платежной системы в интернет-магазине
1. Зайдите в личный кабинет для настройки интеграции. Для входа необходимо использовать авторизационные данные системы EPOS (**идентификатор клиента*** и **секрет****) ([см. скиншот](screens/login.png))
    * [для боевого режима работы](https://cmsgate.esas.by/cmsgate-tilda-epos/config/login)
    * [для тестового режима работы](https://test-cmsgate.esas.by/cmsgate-tilda-epos/config/login)
    
    1. Укажите обязательные параметры
        * EPOS процессинг - выбор организации, выполняющей интеграцию с EPOS
        * Код ПУ – код поставщика услуги в системе EPOS
        * Код услуги – код услуги у поставщика услуг в системе EPOS (один ПУ может предоставлять несколько разных услуг)
        * Код торговой точки – код торговой точки ПУ (у одного ПУ может быть несколько торговых точек)    
        * Секция "Инструкция" - если включена, то на итоговом экране клиенту будет доступна пошаговая инструкция по оплате счета в ЕРИП
        * Секция QR-code - если включена, то на итоговом экране клиенту будет доступна оплата счета по QR-коду
        * Секция Webpay - если включена, то на итоговом экране клиенту отобразится кнопка для оплаты счета картой (переход на Webpay)            
        * Срок действия счета - как долго счет, будет доступен в ЕРИП для оплаты        
        * Текст успешного выставления счета - текст, отображаемый кленту после успешного выставления счета. Может содержать html. В тексте допустимо ссылаться на переменные @order_id, @order_number, @order_total, @order_currency, @order_fullname, @order_phone, @order_address
    1. Сохраните настройки 
    1. Скопируйте **API Secret***** ([см. скиншот](screens/config.png))
       
1. Зайдите в систему администрирования вашего магазина в Tilda
    1. Включить в профиле Tilda (https://tilda.cc/identity/) настройку "Участвовать в тестировании новых функций" (доступна для оплаченных тарифов).
    1. Перейдите в `Настройки сайта → Платежные системы` и выберите пункт `«Универсальная платёжная система»`
    1. Из списка готовых шаблонов выберите `E-POS (ЕРИП Беларусь)`
    1. Укажите обязательные параметры
        * Логин  – **идентификатор клиента***
        * Секрет для подписи заказа - значение скопированное в п.1.3 из поля **API Secret***** ([см. скиншот](screens/tilda_config.png))     
        * URL страницы успеха - адрес страницы, на которую будет перенаправлен пользователь в случае успешной оплаты
        * URL страницы отказа - адрес страницы, на которую будет перенаправлен пользователь, если в процессе оплаты возникнут ошибки.
        * Тестовый режим - если отлючен, то поле логин и секрет для подписи надо брать из реального личного кабинета, иначе из тестового    
    

***идентификатор клиента** (Client ID) - передается службой поддеркжи вместе с остальными данными для настройки интеграции. 
Важно не путить с логином для входа в личный кабинет epos.

****секрет** (Secret) - 39-значный секретный ключ, начинающийся и заканчивающийся символами фигурных скобок. 
Также важно не путать с паролем от личного кабинета epos

*****API Secret** - 8-значный ключ, отображаемый в настройках интеграции и использующийся при настройке шаблона в самой Tilda


